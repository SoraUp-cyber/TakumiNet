<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>temas</title>
    <!-- Socket.io -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../src/footer.css">
    <link rel="stylesheet" href="../src/index.css">
    <link rel="stylesheet" href="../src/nav.css">
    <link rel="stylesheet" href="../src/temas.css">
    <style>

    </style>
    </head>
<body>
<nav class="navbar">
    <!-- Secci√≥n Izquierda: Logo -->
    <div class="navbar-logo">
        <img src="../assets/img/logo.png" alt="Logo de TakumiNet">
    </div>

    <!-- Secci√≥n Central: Enlaces de navegaci√≥n -->
    <ul class="nav-links">
      <li><a href="index.html" class="active" aria-current="page"><i class="fas fa-home"></i> <span data-i18n="inicio">Inicio</span></a></li>
      <li><a href="marketplace.html"><i class="fas fa-store"></i> <span data-i18n="tienda">Tienda</span></a></li>
      <li><a href="game jam.html"><i class="fas fa-calendar-alt"></i> <span data-i18n="game_jams">Game Jams</span></a></li>
      <li><a href="centro-aprendiz.html"><i class="fas fa-graduation-cap"></i> <span data-i18n="tutoriales">Tutoriales</span></a></li>
      <li><a href="ranking.html"><i class="fas fa-newspaper"></i> <span data-i18n="Noticias">Noticias</span></a></li>
      <li><a href="comunidad.html"><i class="fas fa-users"></i> <span data-i18n="comunidad">Comunidad</span></a></li>
    </ul>

    <!-- Secci√≥n Derecha: Elementos interactivos -->
    <div class="nav-right">
      <!-- B√∫squeda -->
      <form class="search-box" role="search">
        <input type="search" class="search-input" placeholder="Buscar juegos, usuarios..." aria-label="Buscar en el sitio" data-i18n="buscar" data-i18n-type="placeholder">
        <button type="submit" class="search-btn" aria-label="Ejecutar b√∫squeda">
          <i class="fas fa-search"></i>
        </button>
      </form>

      <!-- Iconos de notificaciones -->
      <div class="nav-icons">
        <div class="notification-wrapper">
          <button class="icon-btn notification-btn" onclick="toggleNotifications()" aria-haspopup="true" aria-expanded="false" aria-label="Notificaciones">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationBadge" aria-live="polite">0</span>
          </button>

          <!-- Men√∫ desplegable de notificaciones -->
          <div class="dropdown-menu notification-dropdown" id="notificationDropdown" role="menu" aria-hidden="true" style="display:none;">
            <div class="dropdown-header">
              <h4 class="dropdown-title" data-i18n="notificaciones">Notificaciones</h4>
              <button class="mark-read" id="markReadBtn" data-i18n="ver_todas">Marcar todas como le√≠das</button>
            </div>

            <div class="notifications-list" id="notificationsList">
              <!-- Aqu√≠ se insertar√°n las notificaciones din√°micamente -->
            </div>
            <div class="dropdown-footer">
              <a href="/notificaciones" class="view-all" data-i18n="ver_todas">Ver todas</a>
            </div>
          </div>
        </div>

        <!-- Carrito de compras -->
        <div class="icon-btn cart-btn" aria-label="Carrito de compras" role="button" tabindex="0" onclick="toggleCart()">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-badge" aria-live="polite">5</span>
        </div>

        <!-- Men√∫ de usuario -->
        <div class="user-menu">
          <button class="user-profile" aria-haspopup="true" aria-expanded="false" onclick="toggleUserMenu()">
            <div class="avatar">
              <i class="fas fa-user"></i>
            </div>
            <span class="username" id="mostrarNombre">Invitado</span>
          </button>

          <!-- Men√∫ desplegable de usuario -->
          <div class="user-dropdown" id="userDropdown" role="menu" aria-hidden="true">
            <div class="dropdown-group">
              <a href="perfil del usuario.html" class="menu-item"><i class="fas fa-user"></i><span data-i18n="perfil">Perfil</span></a>
              <a href="mis juegos.html" class="menu-item"><i class="fas fa-gamepad"></i><span data-i18n="mis_juegos">Mis Juegos</span></a>
              <a href="juegos favoritos.html" class="menu-item"><i class="fas fa-heart"></i><span data-i18n="favoritos">Favoritos</span></a>
              <a href="Creator Dashboard.html" class="menu-item"><i class="fas fa-tachometer-alt"></i><span data-i18n="dashboard">Dashboard</span></a>
              <a href="subir_juegos.html" class="menu-item"><i class="fas fa-upload"></i><span data-i18n="subir_juego">Subir Juego</span></a>
            </div>
            <div class="dropdown-group">
              <a href="biblioteca.html" class="menu-item"><i class="fas fa-book"></i><span data-i18n="biblioteca">Biblioteca</span></a>
              <a href="descarga.html" class="menu-item"><i class="fas fa-download"></i><span data-i18n="descargas">Descargas</span></a>
            </div>
            <hr class="divider">
            <div class="dropdown-group">
              <a href="configuracion.html" class="menu-item"><i class="fas fa-cog"></i><span data-i18n="configuracion">Configuraci√≥n</span></a>
              <a href="perfil-editar.html" class="menu-item"><i class="fas fa-user-edit"></i><span data-i18n="editar_usuario">Editar Usuario</span></a>
                <a href="pagos-desarrollador.html" class="menu-item"><i class="fas fa-money-bill-wave"></i><span data-i18n="pagos">Pagos</span></a>
              <a href="seguidos.html" class="menu-item"><i class="fas fa-heart"></i><span data-i18n="seguidos">Seguidos</span></a>
            </div>
            <hr class="divider">
            <div class="dropdown-group">
              <button class="menu-item logout"><i class="fas fa-sign-out-alt"></i><span data-i18n="cerrar_sesion">Cerrar Sesi√≥n</span></button>
            </div>
          </div>
        </div>
      </div>
    </div>
</nav>


<!-- ==== Barra de navegaci√≥n ==== -->
<nav class="config-navbar">
  <a href="jams.html" class="back-btn" title="Volver a los temas">
    <i class="fas fa-arrow-left"></i>
  </a>
  <h1 class="config-title">Volver a los temas</h1>
</nav>

<!-- ==== Contenedor global ==== -->
<div class="tema-container">
  
  <!-- ==== Datos del tema ==== -->
  <section id="tema-detalle" class="tema-detalle">
    <h2 class="tema-titulo">Cargando tema...</h2>
    <p class="tema-descripcion">Aqu√≠ aparecer√° la descripci√≥n del tema.</p>
    <small class="tema-autor">Por: Autor del tema</small>
  </section>

  <!-- ==== Formulario de comentario ==== -->
  <section class="formulario-comentario">
    <h3 class="comentarios-title">üí¨ Deja tu comentario</h3>
    <form id="formComentario" class="comentario-form">
      <textarea id="inputComentario" placeholder="Escribe tu comentario..." required></textarea>
      <button type="submit">Publicar comentario</button>
    </form>
  </section>

  <!-- ==== Lista de comentarios ==== -->
  <section class="comentarios-section">
    <h3 class="comentarios-title">Comentarios</h3>
    <ul id="lista-comentarios" class="comentarios-lista">
      <li class="comentario-item">Cargando comentarios...</li>
    </ul>
  </section>

</div>

</div> <!-- /tema-container -->
<!-- Socket.io -->
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script src="../js/notificacion.js"></script>
  <script src="../js/carrito.js"></script>
  <script src="../js/user.js"></script>
  <script src="../js/desplegar.js"></script>
  <script src="../js/cerrar sesion.js"></script>
  <script src="../cookies.js"></script>
<script src="../autoSync.js"></script>
<script src="../js/usario.js"></script>
<script src="../js/temas.js"></script>
  <script src="../script.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const API_BASE = 'http://localhost:3001';

  // Leer ID de tema desde la URL
  const params = new URLSearchParams(window.location.search);
  const temaId = params.get('id_tema');

  // Elementos HTML
  const tituloTema = document.querySelector('.tema-titulo');
  const descripcionTema = document.querySelector('.tema-descripcion');
  const autorTema = document.querySelector('.tema-autor');
  const listaComentarios = document.getElementById('lista-comentarios');
  const form = document.getElementById('formComentario');
  const input = document.getElementById('inputComentario');

  // 1Ô∏è‚É£ Cargar datos del tema
  async function cargarTema() {
    try {
      const res = await fetch(`${API_BASE}/api/temas/${temaId}`);
      const data = await res.json();

      if (data.ok && data.tema) {
        tituloTema.textContent = data.tema.titulo;
        descripcionTema.textContent = data.tema.descripcion;
        autorTema.textContent = `Por: ${data.tema.usuario}`;
      } else {
        tituloTema.textContent = '‚ùå Tema no encontrado';
      }
    } catch (err) {
      console.error('Error cargando tema:', err);
      tituloTema.textContent = '‚ùå Error al cargar el tema';
    }
  }

  // 2Ô∏è‚É£ Cargar lista de comentarios
  async function cargarComentarios() {
    try {
      const res = await fetch(`${API_BASE}/api/temas/${temaId}/comentarios`);
      const data = await res.json();
      listaComentarios.innerHTML = '';

      if (data.ok && data.comentarios.length) {
        data.comentarios.forEach(c => agregarComentarioDOM(c));
      } else {
        listaComentarios.innerHTML = '<li class="comentario-item">No hay comentarios a√∫n.</li>';
      }
    } catch (err) {
      console.error('Error cargando comentarios:', err);
      listaComentarios.innerHTML = '<li class="comentario-item">‚ùå Error al cargar comentarios</li>';
    }
  }

  // 3Ô∏è‚É£ Funci√≥n para agregar comentario al DOM
  function agregarComentarioDOM(comentario) {
    const li = document.createElement('li');
    li.classList.add('comentario-item');
    li.innerHTML = `
      <strong>${comentario.usuario}</strong> 
      <span class="comentario-fecha">(${new Date(comentario.fecha).toLocaleString()})</span>
      <p>${comentario.texto}</p>
    `;
    listaComentarios.prepend(li);
  }

  // 4Ô∏è‚É£ Enviar nuevo comentario
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const userData = JSON.parse(localStorage.getItem('takumi_user') || '{}');
    const usuario = userData.username || 'Invitado';
    const texto = input.value.trim();

    if (!texto) return;

    try {
      const res = await fetch(`${API_BASE}/api/temas/${temaId}/comentarios`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ texto, usuario })
      });

      const data = await res.json();
      if (data.ok) {
        agregarComentarioDOM(data.comentario); // A√±adir al DOM sin recargar
        input.value = '';
      }
    } catch (err) {
      console.error('Error enviando comentario:', err);
    }
  });

  // 5Ô∏è‚É£ Inicializar carga
  cargarTema();
  cargarComentarios();
});
</script>
</body>
</html>